<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)-->
    <script defer=true src="/assets/js/main.min.js"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!--Favicon-->
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- Canonical -->
    <link rel="canonical" href="http://localhost:4000/2018/05/19/File-Based-Honeypots-with-Auditd.html">

    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="IronMoon" href="http://localhost:4000///feed.xml"/>

    <!-- Font Awesome -->
    <!-- <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
    <link rel="stylesheet" type="text/css" href="/assets/css/vendor/font-awesome.min.css">

    <!-- Google Fonts -->
    
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css"> 
    

    <!-- KaTeX 0.8.3 -->
    
    <link rel="stylesheet" type="text/css" href="/assets/css/vendor/katex.min.css">
    <script src="/assets/js/vendor/katex.min.js">
    </script>
    

    <!-- Google Analytics -->
    
    
    <!-- seo tags -->
    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>File Based Honeypots with Auditd | IronMoon</title>
<meta name="generator" content="Jekyll v3.8.1" />
<meta property="og:title" content="File Based Honeypots with Auditd" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Honeypots are all the rage with them being a fantastic tool to quickly identify malicious activity from usual system activity. There are many kinds of honeypots, including honeypot ports (honeyports) and even entire honey networks (honeynet), however the one I want to talk about is honeypot files (honeyfiles)." />
<meta property="og:description" content="Honeypots are all the rage with them being a fantastic tool to quickly identify malicious activity from usual system activity. There are many kinds of honeypots, including honeypot ports (honeyports) and even entire honey networks (honeynet), however the one I want to talk about is honeypot files (honeyfiles)." />
<link rel="canonical" href="http://localhost:4000/2018/05/19/File-Based-Honeypots-with-Auditd.html" />
<meta property="og:url" content="http://localhost:4000/2018/05/19/File-Based-Honeypots-with-Auditd.html" />
<meta property="og:site_name" content="IronMoon" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-05-19T09:00:00+10:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"File Based Honeypots with Auditd","dateModified":"2018-05-19T09:00:00+10:00","datePublished":"2018-05-19T09:00:00+10:00","url":"http://localhost:4000/2018/05/19/File-Based-Honeypots-with-Auditd.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2018/05/19/File-Based-Honeypots-with-Auditd.html"},"description":"Honeypots are all the rage with them being a fantastic tool to quickly identify malicious activity from usual system activity. There are many kinds of honeypots, including honeypot ports (honeyports) and even entire honey networks (honeynet), however the one I want to talk about is honeypot files (honeyfiles).","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <!-- Manual seo tags -->
    <!--
    <title>File Based Honeypots with Auditd | IronMoon</title>
    <meta name="description" content="Honeypots are all the rage with them being a fantastic tool to quickly identify malicious activity from usual system activity. There are many kinds of honeyp...">
    -->
</head>

  <body>
    <header class="site-header">
    
    <!-- Logo and title -->
	<div class="branding">
		<a href="/">
			<img class="avatar" src="/assets/img/triangle.svg" alt=""/>
		</a>

		<h1 class="site-title">
			<a href="/">IronMoon</a>
		</h1>
	</div>
    
    <!-- Toggle menu -->
    <nav class="clear">
    <a id="pull" class="toggle" href="#">
    <i class="fa fa-bars fa-lg"></i>
    </a>
    
    <!-- Menu -->
    <ul class="hide">
        <!-- Auto Generation of NORMAL pages in the navbar -->
        
        
        
        
        
        
        
        <li class="separator"> | </li>
        <li>
            <a class="clear" href="/about/">
                About
            </a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
         
        
        <!-- Auto Generation of SPECIAL pages in the navbar -->
        
          
            <li class="separator"> | </li>
            <li>
                <a class="clear" href="http://localhost:4000/search">
                    <i class="fa fa-search" aria-hidden="true"></i>
                </a>
            </li>
          
        
          
            <li class="separator"> | </li>
            <li>
                <a class="clear" href="http://localhost:4000/tags">
                    <i class="fa fa-tags" aria-hidden="true"></i>
                </a>
            </li>
          
        
    </ul>
        
	</nav>
</header>

    <div class="content">
      <article class="feature-image">
  <header id="main" style="background-image: url('/assets/img/pexels/computer.jpeg')">
    <h1 id="File+Based+Honeypots+with+Auditd" class="title">File Based Honeypots with Auditd</h1>
    <p class="meta">
    May 19, 2018
    
    </p>
  </header>
  <section class="post-content"><p>Honeypots are all the rage with them being a fantastic tool to quickly identify malicious activity from usual system activity. There are many kinds of honeypots, including honeypot ports (honeyports) and even entire honey networks (honeynet), however the one I want to talk about is honeypot files (honeyfiles).</p>

<p>Honeyfiles are files that can be placed on a filesystem that are designed to look entising, and when accessed trigger an auditd rule to let you know. An example could be putting a file called “passwords.txt” on the filesystem. Any attacker that gains access to the system is likely to want to know what that file contains.</p>

<p>We can start by creating some random files to put around the filesystem</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dd if=/dev/urandom of=/SQLBackup-2017-11-24.gzip bs=120334KB count=1 iflag=fullblock
dd if=/dev/urandom of=/root/passwords_encrypted.txt bs=334KB count=1 iflag=fullblock
dd if=/dev/urandom of=/opt/apache-db-preupgrade.db bs=162334KB count=1 iflag=fullblock
</code></pre></div></div>

<p>The content of the files don’t matter, even touching the files will be enough to trigger an alert. However, providing some legitimate but useless data may servce to wase the time of the attacker, giving you more time to repond.</p>

<p>Next we need to ensure that auditd is installed and running, on CentOS this would be done through the following commands:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install audit
systemctl enable auditd
systemctl start auditd
</code></pre></div></div>

<p>Next we create our custom rule files in auditd</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ironmoon ~ # vim /etc/audit/rules.d/70-honeyfiles.rules
-w /SQLBackup-2017-11-24.gzip -p wra -k HONEYFILE_ACCESSS
-w /root/passwords_encrypted.txt -p wra -k HONEYFILE_ACCESSS
-w /opt/apache-db-preupgrade.db -p wra -k HONEYFILE_ACCESSS
</code></pre></div></div>

<p>In these rules “-w” means file followed by the filepath, and “-p wra” means trigger on file read, write, or attribute change. With the rule created we just need to make sure its imported and auditd reloads the configuration.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ironmoon ~ # augenrules
root@ironmoon ~ # pkill -HUP -P 1 auditd
</code></pre></div></div>

<p>Now when we even access the files we will get a triggered alert</p>

<p>root@ironmoon / # aureport -f</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>File Report
===============================================
# date time file syscall success exe auid event
===============================================
1. 19/05/18 23:32:35 passwords_encrypted.txt 191 no /usr/bin/ls 1000 337
2. 19/05/18 23:32:41 passwords_encrypted.txt 192 yes /usr/bin/stat 1000 340
3. 19/05/18 23:36:17 passwords_encrypted.txt 191 no /usr/bin/ls 1000 341
4. 19/05/18 23:36:21 SQLBackup-2017-11-24.gzip 191 no /usr/bin/ls 1000 342
5. 19/05/18 23:38:26 SQLBackup-2017-11-24.gzip 191 no /usr/bin/ls 1000 343
6. 19/05/18 23:38:26 SQLBackup-2017-11-24.gzip 192 yes /usr/bin/ls 1000 344
7. 19/05/18 23:38:26 SQLBackup-2017-11-24.gzip 191 no /usr/bin/ls 1000 345
8. 19/05/18 23:38:26 SQLBackup-2017-11-24.gzip 191 no /usr/bin/ls 1000 346
</code></pre></div></div>

<p>This allows us to see all the access to those files, but you may notice that you will recieve information about ALL access, including simply grabbing info about the file from the ls command, as a result some filtering is required.</p>

<p>Now when its collected at a network loging server you can set up alerts whenever any access to the file is attempted. If we wanted the auditd logs to be forwared to syslog to be included in system logs, you can do that with the following setting</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ironmoon ~ # vim /etc/audisp/plugins.d/syslog.conf
active = yes
</code></pre></div></div>

</section>
  
  <!-- Social media shares -->
  <footer>
<div class="share-buttons">
<ul class="share-buttons">
	

	
	<li>
		<a href="https://twitter.com/intent/tweet?source=http://localhost:4000/2018/05/19/File-Based-Honeypots-with-Auditd.html&text=File Based Honeypots with Auditd%20%7C%20IronMoon:%20http://localhost:4000/2018/05/19/File-Based-Honeypots-with-Auditd.html" target="_blank" title="Tweet">
			<i class="fa fa-twitter-square fa-2x" aria-hidden="true"></i>
			<span class="sr-only">Tweet</span>
		</a>
	</li>
	

	

	

	

	

	
	<li>
		<a href="http://www.reddit.com/submit?url=http://localhost:4000/2018/05/19/File-Based-Honeypots-with-Auditd.html&title=File Based Honeypots with Auditd%20%7C%20IronMoon" target="_blank" title="Share on Reddit">
			<i class="fa fa-reddit-square fa-2x" aria-hidden="true"></i>
			<span class="sr-only">Share on Reddit</span>
		</a>
	</li>
	

	

	

	
	<li>
		<a href="mailto:?subject=File Based Honeypots with Auditd%20%7C%20IronMoon&body=:%20http://localhost:4000/2018/05/19/File-Based-Honeypots-with-Auditd.html" target="_blank" title="Email">
			<i class="fa fa-envelope-square fa-2x" aria-hidden="true"></i>
			<span class="sr-only">Email</span>
		</a>
	</li>
	
</ul>
</div>
</footer>

   
   <!-- Tag list -->
  
  


<footer>
  <div class="tag-list">
    
      <div class="meta">Tags</div>
    

    
    <a class="button" href="/tags#Auditd">
      <p><i class="fa fa-tag fa-fw"></i> Auditd</p>
    </a>
    
    <a class="button" href="/tags#Honeypots">
      <p><i class="fa fa-tag fa-fw"></i> Honeypots</p>
    </a>
    
    <a class="button" href="/tags#Linux">
      <p><i class="fa fa-tag fa-fw"></i> Linux</p>
    </a>
    
    <a class="button" href="/tags#Security">
      <p><i class="fa fa-tag fa-fw"></i> Security</p>
    </a>
    
  </div>
</footer>

    
</article>

<!-- Disqus -->


<!-- Post navigation -->

  <div id="post-nav">
  
  <div id="previous-post" class="post-nav-post">
      <p>Previous post</p>
      <a href="/2013/06/24/A_Tale_of_102_RFID_Cards.html">
        A tale of 102 RFID cards
      </a>
  </div>
  
  
  <div id="next-post" class="post-nav-post">
      <p>Next post</p>
      <a href="/2018/05/20/File-Tarpits.html">
        File Tarpits: Potential Linux Filesystem Tricks to Frustrate Attackers
      </a>
  </div>
  
</div>

    </div>
    
<footer class="site-footer">
    <p class="text">Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a>
</p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                
<li>
	<a href="http://localhost:4000/feed.xml" title="Follow RSS feed">
		<span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
        </span>
	</a>
</li>















<li>
	<a href="https://github.com/skygrip" title="Follow on GitHub">
		<span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-github fa-stack-1x fa-inverse"></i>
        </span>
	</a>
</li>
































                </ul>
            </div>
</footer>




  </body>
</html>
